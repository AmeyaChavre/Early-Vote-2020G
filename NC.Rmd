---
title: "North Carolina Early Voting Statistics"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(kableExtra)
library(scales)
library(DT)
library(highcharter)

state_stats <- read_csv("D:/DropBox/Dropbox/Mail_Ballots_2020/markdown/2020G_Early_Vote.csv")

NC_stats <- read_csv("D:/DropBox/Dropbox/Mail_Ballots_2020/markdown/2020G_Early_Vote_NC.csv")
NC_FIPS <- read_csv("D:/DropBox/Dropbox/Mail_Ballots_2020/markdown/NC_FIPS.csv")

# Setup

party_shell <- data.frame(Party=character(),
                                  Count=integer(),
                                  Percent=double(),
                                  stringsAsFactors=FALSE)
party_shell[1,1] <- "Democrats"
party_shell[2,1] <- "Republicans"
party_shell[3,1] <- "Minor"
party_shell[4,1] <- "No Party Affiliation"
party_shell[5,1] <- "TOTAL"

race_shell <- data.frame(Race=character(),
                                  Count=integer(),
                                  Percent=double(),
                                  stringsAsFactors=FALSE)
race_shell[1,1] <- "Non-Hispanic White"
race_shell[2,1] <- "Non-Hispanic Black"
race_shell[3,1] <- "Hispanic"
race_shell[4,1] <- "Non-Hispanic Asian American"
race_shell[5,1] <- "Non-Hispanic Native American"
race_shell[6,1] <- "Other/Multiple/Unknown"
race_shell[7,1] <- "TOTAL"


gender_shell <- data.frame(Gender=character(),
                                  Count=integer(),
                                  Percent=double(),
                                  stringsAsFactors=FALSE)
gender_shell[1,1] <- "Female"
gender_shell[2,1] <- "Male"
gender_shell[3,1] <- "Unknown"
gender_shell[4,1] <- "TOTAL"

NC_age_shell <- data.frame(Age=character(),
                                  Count=integer(),
                                  Percent=double(),
                                  stringsAsFactors=FALSE)
NC_age_shell[1,1] <- "18 to 25"
NC_age_shell[2,1] <- "26 to 40"
NC_age_shell[3,1] <- "41 to 65"
NC_age_shell[4,1] <- "66 to up"
NC_age_shell[5,1] <- "TOTAL"

# North Carolina

NC_req_send_party <- party_shell

NC_req_send_party[1,2] <- state_stats[34,10] 
NC_req_send_party[2,2] <- state_stats[34,11] 
NC_req_send_party[3,2] <- state_stats[34,12] 
NC_req_send_party[4,2] <- state_stats[34,13] 
NC_req_send_party[5,2] <- state_stats[34,5] 

NC_req_send_party$Percent <- 100*NC_req_send_party$Count/NC_req_send_party[5,2]


NC_accept_party <- party_shell

NC_accept_party[1,2] <- state_stats[34,29] 
NC_accept_party[2,2] <- state_stats[34,30] 
NC_accept_party[3,2] <- state_stats[34,31] 
NC_accept_party[4,2] <- state_stats[34,32] 
NC_accept_party[5,2] <- state_stats[34,6] 

NC_accept_party$Percent <- 100*NC_accept_party$Count/NC_accept_party[5,2]

NC_req_send_race <- race_shell

NC_req_send_race[1,2] <- sum(state_stats[34,14])
NC_req_send_race[2,2] <- sum(state_stats[34,15]) 
NC_req_send_race[3,2] <- sum(state_stats[34,16]) 
NC_req_send_race[4,2] <- sum(state_stats[34,17]) 
NC_req_send_race[5,2] <- sum(state_stats[34,18]) 
NC_req_send_race[6,2] <- sum(state_stats[34,19]) 
NC_req_send_race[7,2] <- sum(state_stats[34,5]) 

NC_req_send_race$Percent <- 100 * NC_req_send_race$Count/NC_req_send_race[7,2]

NC_req_send_gender <- gender_shell

NC_req_send_gender[1,2] <- sum(state_stats[34,21])
NC_req_send_gender[2,2] <- sum(state_stats[34,20]) 
NC_req_send_gender[3,2] <- sum(state_stats[34,22]) 
NC_req_send_gender[4,2] <- sum(state_stats[34,5]) 

NC_req_send_gender$Percent <- 100 * NC_req_send_gender$Count/NC_req_send_gender[4,2]

NC_req_send_age <- NC_age_shell

NC_req_send_age[1,2] <- sum(NC_stats$Mail.Req.Age.1825, na.rm = T)
NC_req_send_age[2,2] <- sum(NC_stats$Mail.Req.Age.2640, na.rm = T) 
NC_req_send_age[3,2] <- sum(NC_stats$Mail.Req.Age.4165, na.rm = T) 
NC_req_send_age[4,2] <- sum(NC_stats$Mail.Req.Age.65up, na.rm = T) 
NC_req_send_age[5,2] <- sum(NC_stats$Mail.Req.Tot, na.rm = T)

NC_req_send_age$Percent <- 100 * NC_req_send_age$Count/NC_req_send_age[5,2]

NC_stats_requests <- select(NC_stats, County, Reg.Voters, Mail.Req.Tot, Pct.Request)
NC_stats_returns <- select(NC_stats, County, Mail.Req.Tot, Mail.Rtn.Tot, Pct.Return)
```

Last Report: `r state_stats[34,9]`  
Source:  `r state_stats[34,2]`

### Discussion

North Carolina is the first state to begin general election voting. Election officials sent ballots to voters on September 4.

Military and overseas civilian voters are the first voters to return ballots. Election officials can deliver ballots to these voters electronically. In North Carolina, these voters have the option of printing, filling out, scanning, and returning their ballots electronically. These initial ballot return numbers are thus not representative of all North Carolinian voters.

### Mail Ballots Cast by Party Registration

``` {r echo = FALSE}
kable(NC_accept_party, format.args = list(big.mark = ",", 
  scientific = FALSE), digits = 1) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

### County Map: Mail Ballot Return Rates ### 

``` {r echo = FALSE}

NC_2020g_map_data <- left_join(NC_stats, NC_FIPS, by = "County")

NC_2020g_map_data$fips <- as.character(NC_2020g_map_data$FIPS_NUM)

NC_2020g_map_data <- mutate(NC_2020g_map_data, percent_returned = round(100*Pct.Return, digits = 1))

mapfile <- download_map_data("countries/us/us-nc-all.js")
mapdata <- get_data_from_map(mapfile)

mapdata$row <- as.integer(rownames(mapdata))

NC_2020g_map_data <- left_join(NC_2020g_map_data, mapdata, by = "fips")

NC_2020g_map_data <- arrange(NC_2020g_map_data, row)

hcmap(map = "countries/us/us-nc-all", data = NC_2020g_map_data,
  value = "percent_returned", name = "Percent Requested", joinby = "fips") 
```

### County Data: Mail Ballots Returned ### 

``` {r echo = FALSE}
datatable(NC_stats_returns, colnames = c("County", "Mail Ballots Requested", "Mail Ballots Returned", "Percent Returned"), rownames = F) %>%
  formatPercentage('Pct.Return', 1) %>%
  formatRound(c('Mail.Req.Tot','Mail.Rtn.Tot'), 0, mark = ",")
```


### Mail Ballot Requests by Party Registration

``` {r echo = FALSE}
kable(NC_req_send_party, format.args = list(big.mark = ",", 
  scientific = FALSE), digits = 1) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

North Carolina registered Democrats have a **`r format(as.numeric(NC_req_send_party[1,2]-NC_req_send_party[2,2]), big.mark =",")`** ballot request lead over registered Republicans.

### County Map: Mail Ballot Request Rates ### 
North Carolina releases an update to the voter registration file each Saturday. The voter registration numbers are from the most recent release and may be slightly dated.

``` {r echo = FALSE}

NC_2020g_map_data <- left_join(NC_stats, NC_FIPS, by = "County")

NC_2020g_map_data$fips <- as.character(NC_2020g_map_data$FIPS_NUM)

NC_2020g_map_data <- mutate(NC_2020g_map_data, percent_requested = round(100*Pct.Request, digits = 1))

mapfile <- download_map_data("countries/us/us-nc-all.js")
mapdata <- get_data_from_map(mapfile)

mapdata$row <- as.integer(rownames(mapdata))

NC_2020g_map_data <- left_join(NC_2020g_map_data, mapdata, by = "fips")

NC_2020g_map_data <- arrange(NC_2020g_map_data, row)

hcmap(map = "countries/us/us-nc-all", data = NC_2020g_map_data,
  value = "percent_requested", name = "Percent Requested", joinby = "fips") 
```

### County Data: Mail Ballots Requested ### 

``` {r echo = FALSE}
datatable(NC_stats_requests, colnames = c("County", "Registered Voters", "Mail Ballot Requests", "Percent Requested"), rownames = F) %>%
  formatPercentage('Pct.Request', 1) %>%
  formatRound(c('Reg.Voters','Mail.Req.Tot'), 0, mark = ",")
```

### Mail Ballot Requests by Race and Ethnicity

``` {r echo = FALSE}
kable(NC_req_send_race, format.args = list(big.mark = ",", 
  scientific = FALSE), digits = 1) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

### Mail Ballot Requests by Age
North Carolina provides mail ballot request data in age ranges inconsistent with other states' ranges. The age statistics presented here are not included in the national age statistics.

``` {r echo = FALSE}
kable(NC_req_send_age, format.args = list(big.mark = ",", 
  scientific = FALSE), digits = 1) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

### Mail Ballot Requests by Gender

``` {r echo = FALSE}
kable(NC_req_send_gender, format.args = list(big.mark = ",", 
  scientific = FALSE), digits = 1) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```
